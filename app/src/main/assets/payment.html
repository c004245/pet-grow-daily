<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ</title>

    <!-- PortOne (Iamport) Web SDK -->
    <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>

    <style>
        body {
          font-family: Arial, sans-serif;
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
          background-color: #f8f9fa;
        }
        .payment-container {
          background: white;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .product-info {
          text-align: center;
          margin-bottom: 30px;
        }
        .product-title {
          font-size: 24px;
          font-weight: bold;
          color: #333;
          margin-bottom: 10px;
        }
        .product-price {
          font-size: 20px;
          color: #e74c3c;
          font-weight: bold;
        }
        .pay-button {
          width: 100%;
          padding: 15px;
          background-color: #fee500; /* ì¹´ì¹´ì˜¤í˜ì´ ì»¬ëŸ¬ ëŠë‚Œ */
          color: #3c1e1e;
          border: none;
          border-radius: 8px;
          font-size: 18px;
          font-weight: bold;
          cursor: pointer;
          margin-top: 20px;
        }
        .pay-button:hover { background-color: #fdd835; }
        .result-message {
          margin-top: 20px;
          padding: 15px;
          border-radius: 5px;
          text-align: center;
          display: none;
        }
        .success {
          background-color: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }
        .error {
          background-color: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }
        .hint {
          margin-top: 12px;
          color: #666;
          font-size: 13px;
          text-align: center;
        }
    </style>
</head>
<body>
<div class="payment-container">
    <div class="product-info">
        <div id="product-title" class="product-title">ğŸ¾ ì½”íŒ…í˜• ê³ ê¸‰ ì•¨ë²”</div>
        <div>ì‚¬ì§„ ìµœëŒ€ 40ì¥ ìˆ˜ë¡</div>
        <div id="product-price" class="product-price">27,000ì›</div>
    </div>

    <button class="pay-button" onclick="requestPay()">
        ì¹´ì¹´ì˜¤í˜ì´ë¡œ ê²°ì œí•˜ê¸°
    </button>

    <div id="result" class="result-message"></div>

</div>

<script>
    // ==== ì´ˆê¸°í™” ====
    var IMP = window.IMP;
    IMP.init('imp28817041'); // ê°€ë§¹ì  ì‹ë³„ì½”ë“œ

    // Androidì—ì„œ ê°’ì„ ì£¼ì…í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ ìƒí’ˆ ì •ë³´
    var productInfo = {
      name: 'ì½”íŒ…í˜• ê³ ê¸‰ ì•¨ë²”',
      amount: 27000,
      merchantUid: 'album_' + new Date().getTime()
    };

    // Androidì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ (ìƒí’ˆëª…/ê¸ˆì•¡/ì£¼ë¬¸ë²ˆí˜¸ ë™ì  ë°˜ì˜)
    function updateProductInfo(productName, productAmount, merchantUid) {
      console.log('[payment.html] updateProductInfo:', productName, productAmount, merchantUid);

      productInfo.name = productName;
      productInfo.amount = parseInt(productAmount);
      productInfo.merchantUid = merchantUid || ('album_' + new Date().getTime());

      // UI ë°˜ì˜
      document.getElementById('product-title').innerText = 'ğŸ¾ ' + productName;
      document.getElementById('product-price').innerText = productInfo.amount.toLocaleString() + 'ì›';
    }

    // ==== ê²°ì œ ìš”ì²­ ====
    function requestPay() {
      const resultEl = document.getElementById('result');
      resultEl.style.display = 'none';
      resultEl.className = 'result-message';
      resultEl.innerHTML = '';

      // ì°¸ê³ : Web SDK(ëª¨ë°”ì¼)ì—ì„œëŠ” callbackë³´ë‹¤ëŠ” m_redirect_urlì´ í•µì‹¬ì…ë‹ˆë‹¤.
      IMP.request_pay({
        pg: 'kakaopay.TC0ONETIME',         // âœ… í…ŒìŠ¤íŠ¸ìš©. ìš´ì˜ ì „í™˜ ì‹œ 'kakaopay'ë¡œ êµì²´
        pay_method: 'kakaopay',            // ëª…ì‹œì ìœ¼ë¡œ ì¹´ì¹´ì˜¤í˜ì´
        merchant_uid: productInfo.merchantUid,
        name: productInfo.name,
        amount: productInfo.amount,

        // âœ… ì™¸ë¶€ ì•±ì—ì„œ ì—´ ìˆ˜ ìˆëŠ” ì£¼ì†Œë§Œ ì‚¬ìš© (file:// ê¸ˆì§€)
        // ì»¤ìŠ¤í…€ ìŠ¤í‚´ìœ¼ë¡œ ì•± ë³µê·€ â†’ WebViewClientì—ì„œ ì²˜ë¦¬
        m_redirect_url: 'petgrowdaily://pay/result'
        // Web SDKì—ì„œëŠ” app_scheme íŒŒë¼ë¯¸í„°ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      }, function (rsp) {
        // ëª¨ë°”ì¼ì—ì„  ë³´í†µ m_redirect_urlë¡œ ë³µê·€ë˜ë¯€ë¡œ ì´ ì½œë°±ì€ ì°¸ê³ ìš©ì…ë‹ˆë‹¤.
        console.log('[payment.html] callback:', rsp);

        // (ë°ìŠ¤í¬í†± í…ŒìŠ¤íŠ¸ ë“±) ì½œë°±ì´ ë™ì‘í•˜ëŠ” ê²½ìš°ì— ëŒ€ë¹„í•˜ì—¬ ê°„ë‹¨ í‘œê¸°
        resultEl.style.display = 'block';
        if (rsp.success) {
          resultEl.className = 'result-message success';
          resultEl.innerHTML =
            'âœ… ê²°ì œ ìš”ì²­ ì„±ê³µ (callback)<br>' +
            'ê±°ë˜ë²ˆí˜¸: ' + rsp.imp_uid + '<br>' +
            'ê²°ì œê¸ˆì•¡: ' + (rsp.paid_amount || productInfo.amount).toLocaleString() + 'ì›';
          try {
            if (window.Android && typeof window.Android.onPaymentSuccess === 'function') {
              window.Android.onPaymentSuccess(rsp.imp_uid, String(rsp.paid_amount || productInfo.amount));
            }
          } catch (e) { console.warn('Android.onPaymentSuccess (callback) error:', e); }
        } else {
          resultEl.className = 'result-message error';
          resultEl.innerHTML = 'âŒ ê²°ì œ ì‹¤íŒ¨ (callback)<br>' + (rsp.error_msg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          try {
            if (window.Android && typeof window.Android.onPaymentFailure === 'function') {
              window.Android.onPaymentFailure(rsp.error_msg || 'ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          } catch (e) { console.warn('Android.onPaymentFailure (callback) error:', e); }
        }
      });
    }

    // ë””ë²„ê·¸ìš©: Android ì¸í„°í˜ì´ìŠ¤ ìœ ë¬´ í™•ì¸ ë¡œê·¸
    window.addEventListener('load', function () {
      console.log('[payment.html] loaded. Android interface available:', !!window.Android);
      try {
        console.log('[payment.html] Android methods:', window.Android ? Object.keys(window.Android) : 'N/A');
      } catch (_) {}
    });
</script>
</body>
</html>
